<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Editar Manipulado</title>
        <link rel="stylesheet" href="css/manipulado.css" />
        <link rel="stylesheet" href="css/print.min.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js" type="text/javascript"></script>
        <%- include('includes/dependencies-top.ejs') %>
        <script src="js/utils/print.min.js"></script>
        <link rel="stylesheet" href="css/ver-manipulado.css">
    </head>

    <body>
        <%- include('includes/navigation.ejs') %>
        <div class="container">
            <form method="post" action="#" id="printJS-form">
                <div class="user-messages hide"></div>
                <h1>Ficha de Preparação</h1>
                <hr />
                <h3>Manipulado</h3>
                <div class="manipulado-container">
                    <h5>Data de preparação</h5>
                    <p class="date"><%= manipulado.createdAt %> </p>
                    <h5>Lote</h5>
                    <p><%= manipulado.lote %></p>
                    <h5>Nome</h5>
                    <p><%= manipulado.nomeManipulado %></p>
                    <h5>Forma farmacêutica</h5>
                    <p><%= manipulado.fFarmNome %></p>
                    <h5>Quantidade a preparar</h5>
                    <p><%= manipulado.fFarmQtd %></p>
                </div>
                <hr />
                <h3>Utente</h3>
                <div class="utente-container">
                    <h5>Nome</h5>
                    <p><%= manipulado.utenteNome %></p>
                    <h5>Contacto</h5>
                    <p><%= manipulado.utenteContacto %></p>
                </div>
                <hr />
                <h3>Prescritor</h3>
                <div class="prescritor-container">
                    <h5>Nome</h5>
                    <p><%= manipulado.prescritorNome %></p>
                    <h5>Contacto</h5>
                    <p><%= manipulado.prescritorContacto %></p>
                </div>
                <hr />
                <h3>Farmacêutico</h3>
                <div class="farmaceutico-container">
                    <h5>Preparador</h5>
                    <p><%= manipulado.farmaceuticoNome %></p>
                    <h5>Supervisor</h5>
                    <p><%= manipulado.farmaceuticoSupervisor %></p>
                </div>
                <hr />
                <h3>Matérias-primas</h3>
                <div class="materias-primas-container">
                    <table
                        id="listaMateriasPrimas"
                        class="mat-prim-table table table-striped table-bordered table-sm"
                    >
                        <thead>
                            <tr>
                                <th class="th-sm">Nome</th>
                                <th class="th-sm">Quantidade</th>
                                <th class="th-sm">Preço</th>
                                <th class="th-sm">Fator</th>
                                <th class="th-sm">Valor</th>
                            </tr>
                            
                        </thead>
                        <tbody>
                            <% for (let i=0; i<manipulado.materiasPrimas.length ;i++) {  %> 
                            <tr class="mat-prim-<%= manipulado.materiasPrimas[i]._id  %>"> 
                                <td><%= manipulado.materiasPrimas[i].nome %></td>
                                <td><%= manipulado.materiasPrimas[i].qtd %></td>
                                <td><%= manipulado.materiasPrimas[i].preco %></td>
                                <td><%= manipulado.materiasPrimas[i].fator %></td>
                                <td><%= manipulado.materiasPrimas[i].valor %></td>                     
                            </tr>
                            <% } %> 
                        </tbody>
                    </table>
                </div>
                <hr />
                <h3>Preparação</h3>
                <div class="preparacao-container">
                    <h5>Modo de preparação</h5>
                    <p><%= manipulado.preparacao %></p>
                </div>
                <hr />
                <h3>Materiais de embalagem</h3>
                <div class="materiais-embalagem-container">
                    <table
                        id="listaMateriaisEmbalagem"
                        class="mat-emb-table table table-striped table-bordered table-sm"
                    >
                        <thead>
                            <tr>
                                <th class="th-sm">Nome</th>
                                <th class="th-sm">Capacidade</th>
                                <th class="th-sm">Quantidade</th>
                                <th class="th-sm">Preço</th>
                                <th class="th-sm">Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% for (let i=0; i<manipulado.materiaisEmbalagem.length ;i++) {  %> 
                            <tr class="mat-prim-<%= manipulado.materiaisEmbalagem[i]._id  %>"> 
                                <td><%= manipulado.materiaisEmbalagem[i].nome %></td>
                                <td><%= manipulado.materiaisEmbalagem[i].capacidade %></td>
                                <td><%= manipulado.materiaisEmbalagem[i].qtd %></td>
                                <td><%= manipulado.materiaisEmbalagem[i].preco %></td>
                                <td><%= manipulado.materiaisEmbalagem[i].valor %></td>                     
                            </tr>
                            <% } %> 
                        </tbody>
                    </table>
                </div>
                <hr />
                <h3>Conservação e prazo de validade</h3>
                <div class="conservacao-container">
                    <h5>Conservação</h5>
                    <p><%= manipulado.conservacao %></p>
                    <h5>Validade</h5>
                    <p><%= manipulado.validade %></p>
                </div>
                <hr />
                <h3>Validação</h3>
                <div class="validacao-container">
                    <table
                        id="listaValidacoes"
                        class="valid-table table table-striped table-bordered table-sm"
                    >
                        <thead>
                            <tr>
                                <th class="th-sm">Nome do Ensaio</th>
                                <th class="th-sm">Especificação</th>
                                <th class="th-sm">Resultado</th>
                                <th class="th-sm">Assinatura</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% for (let i=0; i<manipulado.validacoes.length ;i++) {  %> 
                            <tr class="mat-prim-<%= manipulado.validacoes[i]._id  %>"> 
                                <td><%= manipulado.validacoes[i].nomeEnsaio %></td>
                                <td><%= manipulado.validacoes[i].especificacao %></td>
                                <td><%= manipulado.validacoes[i].resultado %></td>
                                <td></td>              
                            </tr>
                            <% } %> 
                        </tbody>
                    </table>
                </div>
                <hr />
                <div class="calculos-preco">
                    <p>
                        Forma farmacêutica:
                        <span class="forma-farm-total-price"
                            ><%= manipulado.fFarmPrice %></span
                        >
                    </p>
                    <p>
                        Matérias-primas:
                        <span class="mat-prima-total-price"
                            ><%= manipulado.materiasPrimasPrice %></span
                        >
                    </p>
                    <p>
                        Materiais de embalagem:
                        <span class="mat-emb-total-price"
                            ><%= manipulado.materiaisEmbalagemPrice %></span
                        >
                    </p>
                    <p>
                        IVA:
                        <span class="iva-total-price"><%= manipulado.IVA %></span>
                    </p>
                    <p>
                        Total:
                        <span class="total-total-price"
                            ><%= manipulado.totalPrice %></span
                        >
                    </p>
                </div>
                <hr />
                <div>
                    <button type="button" class="btn btn-secondary" id="print-manipulado-button" onclick="printJS({printable: 'printJS-form', type: 'html',
                        ignoreElements: ['print-manipulado-button', 'edit-manipulado-button', 'exit-manipulado-button']})">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                    <button
                        type="button"
                        class="btn btn-warning"
                        id="edit-manipulado-button"
                    >
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button
                        type="button"
                        class="btn btn-primary"
                        id="exit-manipulado-button"
                    >
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                </div>
            </form>
            
        </div>
        <script src="js/ver-manipulado/ver-manipulado.js" ></script>
        <%- include('includes/dependencies-bottom.ejs') %>
    </body>
</html>
